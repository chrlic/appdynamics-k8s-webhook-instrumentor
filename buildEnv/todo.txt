annotations:
    APPD_DEPLOYMENT_NAME: front
    APPD_INSTRUMENTED_CONTAINERS: front
    APPD_POD_INSTRUMENTATION_STATE: Pending
    APPD_front_APPNAME: md-multi-front
    APPD_front_TIERNAME: front

env:
    - name: APPDYNAMICS_AGENT_ACCOUNT_ACCESS_KEY
      valueFrom:
        secretKeyRef:
          key: controller-key
          name: cluster-agent-secret
    - name: JAVA_TOOL_OPTIONS
      value: ' -Dappdynamics.agent.accountAccessKey=$(APPDYNAMICS_AGENT_ACCOUNT_ACCESS_KEY)
        -Dappdynamics.agent.reuse.nodeName=true -Dappdynamics.socket.collection.bci.enable=true
        -javaagent:/opt/appdynamics-java/javaagent.jar'
    - name: APPDYNAMICS_CONTROLLER_HOST_NAME
      value: ceer.saas.appdynamics.com
    - name: APPDYNAMICS_CONTROLLER_PORT
      value: "443"
    - name: APPDYNAMICS_CONTROLLER_SSL_ENABLED
      value: "true"
    - name: APPDYNAMICS_AGENT_ACCOUNT_NAME
      value: ceer
    - name: APPDYNAMICS_AGENT_APPLICATION_NAME
      value: md-multi-front
    - name: APPDYNAMICS_AGENT_TIER_NAME
      value: front
    - name: APPDYNAMICS_AGENT_REUSE_NODE_NAME_PREFIX
      value: front
    - name: APPDYNAMICS_NETVIZ_AGENT_HOST
      valueFrom:
        fieldRef:
          apiVersion: v1
          fieldPath: status.hostIP
    - name: APPDYNAMICS_NETVIZ_AGENT_PORT
      value: "3892"

volumeMounts:
    - mountPath: /opt/appdynamics-java
      name: appd-agent-repo-java
    - mountPath: /opt/appdynamics-java/ver21.11.3.33314/conf/logging/log4j2.xml
      name: appd-agent-configs-java-java-logging-config
      subPath: log4j2.xml

initContainers:
  - command:
    - cp
    - -r
    - /opt/appdynamics/.
    - /opt/appdynamics-java
    image: appdynamics/java-agent:21.11.3
    imagePullPolicy: Always
    name: appd-agent-attach-java
    resources:
      limits:
        cpu: 200m
        memory: 75M
      requests:
        cpu: 100m
        memory: 50M
    terminationMessagePath: /dev/termination-log
    terminationMessagePolicy: File
    volumeMounts:
    - mountPath: /opt/appdynamics-java
      name: appd-agent-repo-java

volumes:
  - emptyDir: {}
    name: appd-agent-repo-java
  - configMap:
      defaultMode: 420
      name: java-logging-config
    name: appd-agent-configs-java-java-logging-config

